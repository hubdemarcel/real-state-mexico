<?php
$pageTitle = 'Tierras.mx - Agentes. Visitas. Créditos. Casas.';
$additionalCss = '
<link rel="stylesheet" href="/Tierrasmx/assets/css/recommendations.css">
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<!-- Leaflet MarkerCluster CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
';
include 'header.php';
?>
    <section class="hero">
        <div class="hero-overlay"></div>
        <div class="container">
            <div class="hero-content" style="display: flex; align-items: center; padding-top: 50px; padding-bottom: 50px; gap: 40px;">
                <div class="hero-image" style="flex: 1;">
                    <img src="https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Beautiful house" style="width: 100%; height: auto; border-radius: 10px;">
                </div>
                <div class="hero-text-and-search" style="flex: 2;">
                    <h1>Encuentra tu Casa Soñada en México</h1>
                    <p>Busca millones de propiedades y conéctate con profesionales inmobiliarios locales</p>
                    <div class="search-bar">
                        <div class="search-container">
                            <div class="search-filters">
                                        <div class="filter-group">
                                            <label for="location-search" class="filter-label">Ubicación</label>
                                            <input type="text" id="location-search" class="search-input" placeholder="Ingresa estado, ciudad o colonia">
                                        </div>
       
                                        <div class="filter-group">
                                            <label for="property-type" class="filter-label">Tipo de Propiedad</label>
                                            <select id="property-type" class="filter-select">
                                                <option value="all">Todas</option>
                                                <option value="casa">Casa</option>
                                                <option value="departamento">Departamento</option>
                                                <option value="terreno">Terreno</option>
                                                <option value="local-comercial">Local Comercial</option>
                                            </select>
                                        </div>
       
                                        <div class="filter-group">
                                            <label for="price-range" class="filter-label">Rango de Precio</label>
                                            <select id="price-range" class="filter-select">
                                                <option value="all">Todos los precios</option>
                                                <option value="0-2000000">$0 - $2,000,000 MXN</option>
                                                <option value="2000000-5000000">$2,000,000 - $5,000,000 MXN</option>
                                                <option value="5000000+">$5,000,000+ MXN</option>
                                            </select>
                                        </div>
       
                                        <div class="filter-group" style="align-self: flex-end;">
                                            <button class="search-button">
                                                <i class="fas fa-search"></i> Buscar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
       
                    <div class="hero-cta" style="text-align: center; margin-top: 2rem;">
                        <p style="margin-bottom: 1rem; color: rgba(255,255,255,0.9);">¿No sabes exactamente qué buscas?</p>
                        <a href="preferences.html" class="search-button" style="display: inline-block; text-decoration: none;">Personalizar mi Búsqueda</a>
                    </div>
                        </div>
                    </div>
                </div>
            </div>

    <main class="container">
        <section class="section section-featured">
            <div class="section-header">
                <h2 class="section-title">Propiedades Destacadas</h2>
                <p class="section-subtitle">Descubre las propiedades más populares en tu zona</p>
            </div>
            
            <div class="properties-grid" id="featuredProperties">
                <!-- Property Card 1 - Mexico City -->
                <div class="property-card" data-id="mx-cdmx-polanco-123-5500000">
                    <div class="property-image">
                        <img src="https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                             alt="Departamento moderno en Polanco, CDMX">
                        <div class="property-badge sale">En Venta</div>
                        <div class="property-badge mx">México</div>
                        <button class="favorite-btn">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    <div class="property-content">
                        <div class="property-price">
                            <i class="fas fa-coins"></i> 
                            <span class="mxn-price">$5,500,000 MXN</span>
                        </div>
                        <div class="property-address">
                            <i class="fas fa-map-marker-alt"></i>
                            Polanco, Miguel Hidalgo
                        </div>
                        <div class="location-hierarchy">
                            <span class="location-item">CDMX</span>
                            <span class="location-separator">></span>
                            <span class="location-item">Miguel Hidalgo</span>
                            <span class="location-separator">></span>
                            <span class="location-item">Polanco</span>
                        </div>
                        <div class="property-stats">
                            <div class="stat">
                                <i class="fas fa-bed"></i>
                                2 recámaras
                            </div>
                            <div class="stat">
                                <i class="fas fa-bath"></i>
                                2 baños
                            </div>
                            <div class="stat">
                                <i class="fas fa-ruler-combined"></i>
                                85 m²
                            </div>
                        </div>
                        <div class="property-features">
                            <span class="feature-badge seguridad">
                                <i class="fas fa-shield-alt"></i> Seguridad 24/7
                            </span>
                            <span class="feature-badge">
                                <i class="fas fa-car"></i> Estacionamiento
                            </span>
                        </div>
                        <p class="property-description">Hermoso departamento moderno en Polanco con vista a la ciudad, excelente ubicación cerca de centros comerciales y restaurantes.</p>
                        <a href="#" class="view-property">Ver propiedad <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>

                <!-- Property Card 2 - Guadalajara -->
                <div class="property-card" data-id="mx-jalisco-guadalajara-456-3200000">
                    <div class="property-image">
                        <img src="https://images.unsplash.com/photo-1600596542815-4a3d32c18c3b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                             alt="Casa familiar en Providencia, Guadalajara">
                        <div class="property-badge sale">En Venta</div>
                        <div class="property-badge mx">México</div>
                        <button class="favorite-btn">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    <div class="property-content">
                        <div class="property-price">
                            <i class="fas fa-coins"></i> 
                            <span class="mxn-price">$3,200,000 MXN</span>
                        </div>
                        <div class="property-address">
                            <i class="fas fa-map-marker-alt"></i>
                            Providencia, Guadalajara
                        </div>
                        <div class="location-hierarchy">
                            <span class="location-item">Jalisco</span>
                            <span class="location-separator">></span>
                            <span class="location-item">Guadalajara</span>
                            <span class="location-separator">></span>
                            <span class="location-item">Providencia</span>
                        </div>
                        <div class="property-stats">
                            <div class="stat">
                                <i class="fas fa-bed"></i>
                                3 recámaras
                            </div>
                            <div class="stat">
                                <i class="fas fa-bath"></i>
                                2.5 baños
                            </div>
                            <div class="stat">
                                <i class="fas fa-ruler-combined"></i>
                                180 m²
                            </div>
                        </div>
                        <div class="property-features">
                            <span class="feature-badge seguridad">
                                <i class="fas fa-shield-alt"></i> Seguridad
                            </span>
                            <span class="feature-badge">
                                <i class="fas fa-utensils"></i> Gas Natural
                            </span>
                            <span class="feature-badge">
                                <i class="fas fa-tint"></i> Agua Potable
                            </span>
                        </div>
                        <p class="property-description">Casa familiar en zona segura de Providencia, con jardín privado y acabados de calidad. Cerca de escuelas y centros comerciales.</p>
                        <a href="#" class="view-property">Ver propiedad <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>

                <!-- Property Card 3 - Monterrey -->
                <div class="property-card" data-id="mx-nl-monterrey-santa-catarina-4500000">
                    <div class="property-image">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                             alt="Terreno en Santa Catarina, Monterrey">
                        <div class="property-badge sale">En Venta</div>
                        <div class="property-badge mx">México</div>
                        <button class="favorite-btn">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    <div class="property-content">
                        <div class="property-price">
                            <i class="fas fa-coins"></i> 
                            <span class="mxn-price">$4,500,000 MXN</span>
                        </div>
                        <div class="property-address">
                            <i class="fas fa-map-marker-alt"></i>
                            Santa Catarina, Monterrey
                        </div>
                        <div class="location-hierarchy">
                            <span class="location-item">Nuevo León</span>
                            <span class="location-separator">></span>
                            <span class="location-item">Monterrey</span>
                            <span class="location-separator">></span>
                            <span class="location-item">Santa Catarina</span>
                        </div>
                        <div class="property-stats">
                            <div class="stat">
                                <i class="fas fa-ruler-combined"></i>
                                500 m² de terreno
                            </div>
                        </div>
                        <div class="property-features">
                            <span class="feature-badge">
                                <i class="fas fa-road"></i> Acceso Pavimentado
                            </span>
                            <span class="feature-badge">
                                <i class="fas fa-bolt"></i> Luz y Agua
                            </span>
                        </div>
                        <p class="property-description">Terreno plano en excelente ubicación de Santa Catarina, ideal para construcción residencial o comercial. Documentación en regla.</p>
                        <a href="#" class="view-property">Ver propiedad <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="view-all-wrapper text-center">
                <button class="btn btn-primary btn-large">Ver Todas las Propiedades</button>
            </div>
        </section>

    

    <!-- Recommendations Section -->
    <section class="section recommendations-section" id="recommendationsSection">
        <div class="container">
            <div class="section-header">
                <div class="recommendations-header">
                    <h2 class="recommendations-title">Propiedades que Tal Vez Te Gusten</h2>
                    <a href="#" class="view-all-link">Ver todas las recomendaciones <i class="fas fa-arrow-right"></i></a>
                </div>
                <p class="section-subtitle">Propiedades similares a las que has visto y guardado</p>
            </div>
            
            <div class="properties-grid" id="recommendationsGrid">
                <!-- Recommendations will be populated dynamically -->
                <div class="recommendations-empty">
                    <div class="recommendations-empty-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3 class="recommendations-empty-title">Sin recomendaciones aún</h3>
                    <p class="recommendations-empty-text">Navega por las propiedades para ver recomendaciones personalizadas basadas en tus preferencias.</p>
                </div>
            </div>
        </div>
    </section>
      

    <!-- Services Section -->
    <section class="section services">
        <div class="section-header">
            <h2 class="section-title">¿Por Qué Elegir Tierras.mx?</h2>
            <p class="section-subtitle">Tu socio de confianza en bienes raíces en México</p>
        </div>
        
        <div class="services-grid">
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-search"></i>
                </div>
                <h3 class="service-title">Búsqueda Avanzada</h3>
                <p class="service-description">Encuentra exactamente lo que buscas con nuestros filtros y herramientas de búsqueda poderosas adaptadas al mercado mexicano.</p>
            </div>
            
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <h3 class="service-title">Experiencia Local</h3>
                <p class="service-description">Conéctate con agentes locales experimentados que conocen tu mercado a fondo, desde CDMX hasta Cancún.</p>
            </div>
            
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h3 class="service-title">Servicio Personalizado</h3>
                <p class="service-description">Obtén recomendaciones personalizadas y guarda tus propiedades favoritas para no perder de vista tus opciones.</p>
            </div>
        </div>
    </section>

    <!-- Properties Map Section -->
    <section class="section properties-map-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Propiedades en México</h2>
                <p class="section-subtitle">Explora todas nuestras propiedades disponibles en el mapa interactivo</p>
            </div>

            <div class="map-container">
                <div id="propertiesMap" class="properties-map"></div>
            </div>

            <div class="map-legend">
                <div class="legend-item">
                    <div class="legend-marker" style="background-color: #2563eb;"></div>
                    <span>Propiedad en Venta</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker" style="background-color: #059669;"></div>
                    <span>Propiedad en Renta</span>
                </div>
            </div>
        </div>
    </section>

<?php
$additionalJs = '
<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<!-- Leaflet MarkerCluster JavaScript -->
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script src="/Tierrasmx/assets/js/main.js"></script>
<script src="/Tierrasmx/assets/js/recommendations.js"></script>
<script src="/Tierrasmx/assets/js/localization.js"></script>
<script src="/Tierrasmx/assets/js/utils.js"></script>
<script src="/Tierrasmx/assets/js/search.js" defer></script>
';
include 'footer.php';
?>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Leaflet MarkerCluster JavaScript -->
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <!-- Properties Map Script -->
    <script>
        // Initialize map when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializePropertiesMap();
        });

        function initializePropertiesMap() {
            const mapElement = document.getElementById('propertiesMap');
            if (!mapElement) return;

            // Initialize map centered on Mexico
            const map = L.map('propertiesMap').setView([23.6345, -102.5528], 5);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18,
            }).addTo(map);

            // Create marker cluster group
            const markers = L.markerClusterGroup({
                chunkedLoading: true,
                chunkInterval: 200,
                chunkDelay: 50,
                spiderfyOnMaxZoom: true,
                showCoverageOnHover: false,
                zoomToBoundsOnClick: true,
                removeOutsideVisibleBounds: true,
                animate: true,
                disableClusteringAtZoom: 16,
                maxClusterRadius: 80,
                iconCreateFunction: function(cluster) {
                    const childCount = cluster.getChildCount();
                    let className = 'marker-cluster-';

                    if (childCount < 10) {
                        className += 'small';
                    } else if (childCount < 100) {
                        className += 'medium';
                    } else {
                        className += 'large';
                    }

                    return new L.DivIcon({
                        html: '<div><span>' + childCount + '</span></div>',
                        className: 'marker-cluster ' + className,
                        iconSize: new L.Point(40, 40)
                    });
                }
            });

            // Load properties data
            fetch('/Tierrasmx/assets/data/properties-mx.json')
                .then(response => response.json())
                .then(properties => {
                    addPropertyMarkers(map, markers, properties);
                    map.addLayer(markers);
                })
                .catch(error => {
                    console.error('Error loading properties:', error);
                });
        }

        function addPropertyMarkers(map, markers, properties) {
            properties.forEach(property => {
                if (property.location && property.location.coordinates) {
                    const { lat, lng } = property.location.coordinates;

                    // Create marker with custom icon
                    const markerIcon = L.divIcon({
                        className: 'property-marker',
                        html: `<div class="marker-content">
                            <i class="fas fa-home"></i>
                            <span class="marker-price">${formatPrice(property.price)}</span>
                        </div>`,
                        iconSize: [80, 30],
                        iconAnchor: [40, 30]
                    });

                    const marker = L.marker([lat, lng], { icon: markerIcon });

                    // Create popup content
                    const popupContent = `
                        <div class="property-popup">
                            <h4>${property.title_es}</h4>
                            <div class="popup-price">${formatPrice(property.price)} MXN</div>
                            <div class="popup-location">
                                <i class="fas fa-map-marker-alt"></i>
                                ${property.location.city}, ${property.location.state}
                            </div>
                            <div class="popup-features">
                                ${property.features.bedrooms ? `<span><i class="fas fa-bed"></i> ${property.features.bedrooms} rec</span>` : ''}
                                ${property.features.bathrooms ? `<span><i class="fas fa-bath"></i> ${property.features.bathrooms} baños</span>` : ''}
                                ${property.features.construction_size ? `<span><i class="fas fa-ruler-combined"></i> ${property.features.construction_size} m²</span>` : ''}
                            </div>
                            <a href="templatepropiedad.html?id=${property.id}" class="popup-link">Ver propiedad</a>
                        </div>
                    `;

                    marker.bindPopup(popupContent);

                    // Add marker to cluster group instead of directly to map
                    markers.addLayer(marker);
                }
            });
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('es-MX', {
                style: 'currency',
                currency: 'MXN',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(price);
        }
    </script>

    <script src="/Tierrasmx/assets/js/main.js"></script>
    <script src="/Tierrasmx/assets/js/recommendations.js"></script>
    <script src="/Tierrasmx/assets/js/localization.js"></script>
    <script src="/Tierrasmx/assets/js/utils.js"></script>
    <script src="/Tierrasmx/assets/js/search.js" defer></script>
</body>
</html>t 